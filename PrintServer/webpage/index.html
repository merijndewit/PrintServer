<!DOCTYPE html>
<html>
<link href='https://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet'>
<body>
    <image src="https://i.ibb.co/PYfFcF9/Print-Server-Logo.png" style="width:20%;">

        <input id="newfile" type="file" onchange="setpath()" style="width:100%;">
        <input id="filepath" type="text">
        <button id="upload" type="button" onclick="upload()">Upload</button>


        <div class="sd_container">
            <img src="https://i.ibb.co/PGtnbyj/sd-card.png" alt="sd-card" style="width:25%;">
            <div class="centered">?</div>
        </div>

        <script>
            function setpath() {
                var default_path = document.getElementById("newfile").files[0].name;
                document.getElementById("filepath").value = default_path;
            }

            function upload() {
                var filePath = document.getElementById("filepath").value;
                var upload_path = "/upload/" + filePath;
                var fileInput = document.getElementById("newfile").files;

                var MAX_FILE_SIZE = 20000 * 1024;
                var MAX_FILE_SIZE_STR = "20MB";

                if (fileInput.length == 0) {
                    alert("No file selected!");
                } else if (filePath.length == 0) {
                    alert("File path on server is not set!");
                } else if (filePath.indexOf(' ') >= 0) {
                    alert("File path on server cannot have spaces!");
                } else if (filePath[filePath.length - 1] == '/') {
                    alert("File name not specified after path!");
                } else if (fileInput[0].size > MAX_FILE_SIZE) {
                    alert("File size must be less than " + MAX_FILE_SIZE_STR + "!");
                } else {
                    document.getElementById("newfile").disabled = true;
                    document.getElementById("filepath").disabled = true;
                    document.getElementById("upload").disabled = true;

                    var file = fileInput[0];
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (xhttp.readyState == 4) {
                            if (xhttp.status == 200) {
                                document.open();
                                document.write(xhttp.responseText);
                                document.close();
                            } else if (xhttp.status == 0) {
                                alert("Server closed the connection abruptly!");
                                location.reload();
                            } else {
                                alert(xhttp.status + " Error!\n" + xhttp.responseText);
                                location.reload();
                            }
                        }
                    };
                    xhttp.open("POST", upload_path, true);
                    xhttp.send(file);
                }
            }

            let socket = new WebSocket('ws://' + window.location.hostname + '/ws');
            socket.onopen = function(event) {
                console.log('Connected to WebSocket server');
            };
            socket.onmessage = function(event) {
                console.log('Message from server: ' + event.data);
            };

            socket.onclose = function(event) {
                console.log('Disconnected from WebSocket server');
            };
        </script>

        <style>
            /* Container holding the image and the text */

            .sd_container {
                position: relative;
                margin-left: auto; 
                margin-right: 0;
                text-align: center;
                color: black;
                float: right;
            }

            /* Centered text */

            .centered {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 3vw;
                /*font-family: 'Audiowide';*/
                font-family: 'Varela Round';
            }
        </style>

</body>

</html>